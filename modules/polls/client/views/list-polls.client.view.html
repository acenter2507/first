<section class="container mg10b" infinite-scroll="vm.get_polls()" infinite-scroll-distance='2'>
  <!-- Toolbar -->
  <div class="row mg12t">
    <div class="col-xs-12 pdn">
      <div class="custom-toolbar">
        <a ui-sref="polls.create" class="btn btn-primary pull-right">Create poll</a>
        <!--<a ng-click="vm.show_toasty()" class="btn btn-warning pull-right mg10r">Toasty</a>-->
        <!--<a ng-click="vm.show_toastr()" class="btn btn-danger pull-right mg10r">Toastr</a>-->
      </div>
    </div>
  </div>

  <div class="row" ng-show="vm.is_has_new_polls">
    <div class="col-xs-12 pdn pd6l pd6r">
      <div class="notice notice-info">
        New poll has just been added, <a class="undecorated-link" ng-click="vm.load_new()">load now</a>.
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-8 col-lg-6 col-lg-push-3 pdn">
      <div ng-repeat="poll in vm.polls" class="card">
        <div clas="poll-header">
          <div class="user-avatar pull-left">
            <a ng-if="poll.user" ui-sref="profile.info({userId: poll.user._id})">
              <img src="{{poll.user.profileImageURL}}" alt="{{poll.user.displayName}}">
            </a>
            <img ng-if="!poll.user" src="modules/users/client/img/profile/default.png" alt="Deleted User">
          </div>
          <span class="pull-left">
            <strong><a class="undecorated-link" ui-sref="profile.info({userId: poll.user._id})" ng-if="poll.user" ng-bind="poll.user.displayName"></a></strong>
            <span ng-if="!poll.user">Deleted User</span>
          <small class="text-muted">&nbsp;created on</small>
          <small class="text-muted" am-time-ago="poll.created"></small>
          </span>
          <span class="pull-right">
            <md-menu md-offset="-12 20" md-position-mode="target-right target">
              <a class="undecorated-link span-link" ng-click="$mdMenu.open($event)" aria-label="Open setting menu">
                <i class="fa fa-angle-down"></i>
              </a>
              <md-menu-content>
                <ul class="menu-list">
                  <li><a ui-sref="polls.view({ pollId: poll._id })"><i class="fa fa-eye"></i>&nbsp;View</a></li>
                  <li ng-if="poll.isCurrentUserOwner"><a class="undecorated-link" ui-sref="polls.edit({ pollId: poll._id })"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</a></li>
                  <li ng-if="poll.isCurrentUserOwner"><a class="undecorated-link" ng-click="vm.delete_poll(poll)"><i class="fa fa-trash"></i>&nbsp;Delete</a></li>
                  <li ng-if="vm.isLogged">
                    <a ng-click="vm.follow_poll(poll)" class="undecorated-link">
                      <i class="fa fa-rss"></i>&nbsp;{{(poll.follow.following) ? 'Unfollow' : 'Follow'}}
                    </a>
                  </li>
                  <li ng-if="vm.isLogged && !poll.isCurrentUserOwner && !poll.reported"><a class="undecorated-link" ng-click="vm.report_poll(poll)"><i class="fa fa-exclamation-circle"></i>&nbsp;Report poll</a></li>
                  <li ng-if="vm.isLogged && !poll.isCurrentUserOwner && !poll.bookmarked"><a class="undecorated-link" ng-click="vm.bookmark_poll(poll)"><i class="fa fa-bookmark"></i>&nbsp;Bookmark poll</a></li>
                </ul>
              </md-menu-content>
            </md-menu>
          </span>
          <br>
          <div class="mg5t">
            <span ng-if="poll.allow_guest" class="fa fa-globe">
              <md-tooltip md-direction="bottom">This poll is public</md-tooltip>
            </span>
            <span ng-if="!poll.allow_guest" class="fa fa-users">
              <md-tooltip md-direction="bottom">Only user can vote</md-tooltip>
            </span>
            <a class="undecorated-link" ui-sref="categorys.polls({ categoryId: poll.category._id })">{{ poll.category.name }}</a>
          </div>
          <div class="clearfix"></div>
          <hr class="mg5t mg10b">
        </div>

        <div clas="poll-body">
          <h3><a ui-sref="polls.view({ pollId: poll._id })">{{poll.title}}</a></h3>
          <!--<p class="text-justify poll_item_body" ng-bind-html="poll.summary | nl2br"></p>-->
          <div class="text-body" ta-bind="text" ng-model="poll.summary" ta-readonly="true"></div>
          <p ng-show="poll.body.length > poll.summary.length" class="poll_item_body">
            <a class="undecorated-link" ui-sref="polls.view({ pollId: poll._id })">see more</a>
          </p>
          <!-- options -->
          <div class="mg10t">
            <span class="text-muted" ng-if="poll.opts.length === 0"><small>No option yet</small></span>
            <a ui-sref="polls.view({ pollId: poll._id })" class="undecorated-link" ng-if="poll.opts.length === 0 && poll.allow_add"><small>, why don't add some option</small></a>
            <div class="col-xs-12 pdn" ng-if="poll.total === 0">
              <div ng-repeat="opt in poll.opts | orderBy: '-voteCnt' | limitTo: 3">
                <strong><span ng-bind="opt.title"></span></strong>
                <div class="progress">
                  <div ng-class="['progress-bar']" ng-class="bar.barClass" ng-style="{'width': opt.progressVal + '%', 'background-color': opt.color}">
                    <span ng-if="opt.voteCnt > 0">{{opt.voteCnt + '/' + poll.total}}</span>
                    <span class="default-text" ng-if="opt.voteCnt === 0">{{opt.voteCnt + '/' + poll.total}}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xs-12 col-md-9 pdn" ng-if="poll.total > 0">
              <div ng-repeat="opt in poll.opts | orderBy: '-voteCnt' | limitTo: 3">
                <strong><span ng-bind="opt.title"></span></strong>
                <div class="progress">
                  <div ng-class="['progress-bar']" ng-class="bar.barClass" ng-style="{'width': opt.progressVal + '%', 'background-color': opt.color}">
                    <span ng-if="opt.voteCnt > 0">{{opt.voteCnt + '/' + poll.total}}</span>
                    <span class="default-text" ng-if="opt.voteCnt === 0">{{opt.voteCnt + '/' + poll.total}}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xs-12 col-md-3 pdn" ng-if="poll.total > 0">
              <div class="chart-block">
                <canvas id="pie" class="chart chart-pie" chart-data="poll.chart.data" chart-labels="poll.chart.labels" chart-options="poll.chart.options"
                  chart-colors="poll.chart.colors">
                </canvas>
              </div>
            </div>
            <div class="clearfix"></div>
            <a class="pull-right undecorated-link" ng-if="poll.opts.length > 3" ui-sref="polls.view({ pollId: poll._id })">...and {{poll.opts.length - 3}} others</a>
          </div>
          <div class="clearfix"></div>
          <!-- #options -->
          <hr class="mg10t mg10b">
        </div>

        <div clas="poll-footer">
          <p class="poll_item_info">
            <i class="fa fa-heart-o" aria-hidden="true"></i>
            <strong> Votes: </strong>{{poll.report.voteCnt}}
          </p>
          <p class="poll_item_info">
            <i class="fa fa-eye" aria-hidden="true"></i>
            <strong> Views: </strong>{{poll.report.viewCnt}}
          </p>
          <p class="poll_item_info">
            <i class="fa fa-commenting" aria-hidden="true"></i>
            <strong> Comments: </strong>{{poll.report.cmtCnt}}
          </p>
        </div>
        <div class="clearfix"></div>
      </div>
      <!-- Loading indicator -->
      <div class="row text-center pd6l pd6r" ng-show="vm.busy">
        <md-progress-circular ng-disabled="!vm.busy" class="md-hue-2 center" md-diameter="20px"></md-progress-circular>
      </div>
      <div class="notice notice-warning" ng-show="vm.polls.length === 0 && vm.stopped">
        No polls yet, why don't you <a ui-sref="polls.create">create one</a>?
      </div>
    </div>
    <!-- Hot poll -->
    <div class="col-xs-12 col-sm-12 col-md-4 col-lg-3 col-lg-push-3 pdn">
      <div class="card activitys expand-card">
        <div class="card-header">
          <strong class="card-title">Ticker</strong>
          <span class="pull-right"><a class="undecorated-link text-muted expand-toggle"><i class="fa fa-caret-down"></i></a></span>
        </div>
        <div class="card-body">
          <div class="side-list-poll" ng-repeat="activity in vm.activitys">
            <div class="user-avatar pull-left">
              <img src="{{activity.profileImageURL}}" alt="{{activity.displayName}}">
            </div>
            <small><strong><a class="undecorated-link" ui-sref="profile.info({userId: activity.user})">{{activity.displayName}}</a></strong></small>
            <small>{{activity.action}}</small>
            <small><strong><a class="undecorated-link" ui-sref="polls.view({pollId: activity.poll})">{{activity.title}}</a></strong></small>
            <div class="clearfix"></div>
            <hr class="mg5t mg5b">
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <strong class="card-title">Popular polls</strong>
          <small class="pull-right undecorated-link" ng-show="vm.bookmarks.length > 0"><a ui-sref="profile.bookmarks({ userId: vm.authentication.user._id })">View all</a></small>
        </div>
        <div class="card-body">
          <div class="side-list-poll" ng-repeat="poll in vm.hot_polls">
            <div class="user-avatar pull-left">
              <a ng-if="poll.user" ui-sref="profile.info({userId: poll.user._id})">
                <img src="{{poll.user.profileImageURL}}" alt="{{poll.user.displayName}}">
              </a>
              <img ng-if="!poll.user" src="modules/users/client/img/profile/default.png" alt="Deleted User">
            </div>
            <div class="side-list-body">
              <h4 class="side-list-title">
                <a class="undecorated-link" ui-sref="polls.view({pollId: poll._id})" ng-bind="poll.title" autoAdjust></a>
              </h4>
              <div class="side-list-entry">
                <small am-time-ago="poll.created"></small>
              </div>
            </div>
            <div class="clearfix"></div>
            <hr class="mg5t mg5b">
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <strong class="card-title">Popular tags</strong>
          <small class="pull-right undecorated-link"><a ui-sref="tags.list">View all</a></small>
        </div>
        <div class="card-body">
          <ul class="tags">
            <li ng-repeat="tag in vm.tags"><a ui-sref="tags.view({ tagId: tag._id })" class="tag">{{tag.name}}</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- LEFT -->
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-3 col-lg-pull-9 pdn">
      <!-- Category -->
      <div class="card">
        <ul class="nav nav-list">
          <li class="nav-header">
            <strong class="card-title">Categorys</strong>
            <small class="pull-right"><a ui-sref="categorys.list">View all</a></small>
          </li>
          <li ng-repeat="category in vm.categorys">
            <a class="undecorated-link" ui-sref="categorys.polls({ categoryId: category._id })">
            <i ng-class="['fa', category.icon]"></i>&nbsp;{{category.name}}
            <span class="badge-count pull-right" ng-bind="category.count"></span>
          </a>
          </li>
        </ul>
      </div>
      <!-- Bookmark -->
      <div class="card" ng-if="vm.isLogged">
        <div class="card-header">
          <strong class="card-title">Bookmarks</strong>
          <small class="pull-right undecorated-link" ng-show="vm.bookmarks.length > 0"><a ui-sref="profile.bookmarks({ userId: vm.authentication.user._id })">View all</a></small>
        </div>
        <div class="card-body">
          <div class="side-list-poll" ng-repeat="poll in vm.bookmarks">
            <div class="user-avatar pull-left">
              <a ng-if="poll.user" ui-sref="profile.info({userId: poll.user._id})">
                <img src="{{poll.user.profileImageURL}}" alt="{{poll.user.displayName}}">
              </a>
              <img ng-if="!poll.user" src="modules/users/client/img/profile/default.png" alt="Deleted User">
            </div>
            <div class="side-list-body">
              <h4 class="side-list-title">
                <a class="undecorated-link" ui-sref="polls.view({pollId: poll._id})" ng-bind="poll.title" autoAdjust></a>
              </h4>
              <div class="side-list-entry">
                <small am-time-ago="poll.created"></small>
              </div>
            </div>
            <div class="clearfix"></div>
            <hr class="mg5t mg5b">
          </div>
        </div>
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
</section>
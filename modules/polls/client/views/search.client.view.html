<section class="container">
  <!-- Breadcrumb -->
  <div class="row mg10t">
    <div class="col-xs-12 pdn">
      <div class="card">
        <div class="card-body">
          <ol class="breadcrumb custom-breadcrumb">
            <li class="breadcrumb-item">
              <a class="undecorated-link" ui-sref="home">
                <i class="fa fa-home"></i> Home
              </a>
            </li>
            <li class="breadcrumb-item active">Search</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 pdn">
      <div class="card card-expand">
        <div class="card-header">
          <strong class="card-title"><i class="fa fa-search"></i> Search tool</strong>
          <a class="undecorated-link card-expand-toggle card-link"><i class="fa fa-arrow-circle-down"></i></a>
          <div class="clearfix"></div>
        </div>
        <hr class="mgn">
        <div class="card-body">
          <form name="form.searchForm" class="form-horizontal" ng-submit="search()" novalidate>
            <div class="form-group">
              <div class="col-md-5">
                <label>Key</label>
                <input type="text" class="form-control" placeholder="Search key" ng-model="condition.key">
              </div>
              <div class="col-md-5">
                <label>In</label>
                <select class="form-control" ng-model="condition.in">
							  	<option value>Not set</option>
							  	<option value="title">Poll's title only</option>
							  	<option value="content">Poll's title and body</option>
							  	<option value="options">Poll and options</option>
							  </select>
              </div>
              <div class="col-md-2">
                <label>&nbsp;</label>
                <button type="submit" class="btn btn-primary btn-block">Search</button>
              </div>
            </div>

            <div class="panel-group" role="tablist" ng-model="detailToggle" aria-multiselectable="true" bs-collapse>
              <div class="panel panel-default custom-panel">
                <div ng-class="{ 'panel-heading': true, 'public': true }" role="tab">
                  <h4 class="panel-title">
                    <i class="fa fa-caret-down"></i>&nbsp;
                    <a class="undecorated-link" bs-collapse-toggle>Advanced Search Setting</a>
                  </h4>
                </div>
                <div class="panel-collapse" role="tabpanel" bs-collapse-target>
                  <div class="panel-body">

                    <div class="form-group">
                      <div class="col-sm-12">
                      <label for="sort">Sort by</label>
                        <select id="sort" name="sort" class="form-control input-sm" ng-model="condition.sort">
                          <option value>Default</option>
                          <option value="-created">Newest to oldest</option>
                          <option value="created">Oldest to newest</option>
                          <option value="-likeCnt">Most likes</option>
                          <option value="likeCnt">Least likes</option>
                          <option value="-cmtCnt">Most comments</option>
                          <option value="cmtCnt">Least comments</option>
                          <option value="-voteCnt">Most votes</option>
                          <option value="voteCnt">Least votes</option>
                          <option value="-viewCnt">Most viewed</option>
                          <option value="viewCnt">Least viewed</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <!-- Status -->
                      <div class="col-sm-6">
                        <label for="status">Status</label>
                        <select id="status" name="status" class="form-control input-sm" ng-model="condition.status">
							          	<option value>All</option>
							          	<option value="opening">Opening</option>
							          	<option value="closed">Closed</option>
							          </select>
                      </div>
                      <!-- User -->
                      <div class="col-sm-6">
                        <label>Posted by</label>
                        <input name="by" type="hidden" class="form-control" ng-model="condition.by">
                        <angucomplete-alt placeholder="Search user" pause="300" selected-object="selectedUserFn" initial-value="selectedUser" remote-url="/api/users/search?s="
                          remote-url-data-field="users" title-field="displayName" description-field="username" image-field="profileImageURL"
                          minlength="1" input-class="form-control input-sm" match-class="highlight" />
                      </div>
                    </div>

                    <div class="form-group">
                      <div class="col-sm-6">
                        <!-- Category -->
                        <label>Category</label>
                        <select id="ctgr" name="ctgr" class="form-control input-sm" ng-model="condition.ctgr">
                          <option value>All</option>
                          <option ng-repeat="category in categorys" value="{{category._id}}" ng-selected="category._id === condition.ctgr">{{category.name}} ({{category.count}})</option>
                        </select>
                      </div>
                      <div class="col-sm-6">
                        <div class="col-sm-12 pdn"><label>Created date</label></div>
                        <div class="col-sm-6 pdn">
                          <input id="created_start" name="created_start" class="form-control input-sm" today="true" moment-picker="condition.created_start"
                            ng-model="condition.created_start" format="YYYY/MM/DD" start-view="month" placeholder="Start date..."
                            additions="{ bottom: 'start_bottom-template-url' }">
                        </div>
                        <div class="col-sm-6 pdn">
                          <input id="created_end" name="created_end" class="form-control input-sm" today="true" moment-picker="condition.created_end"
                            ng-model="condition.created_end" format="YYYY/MM/DD" start-view="month" placeholder="End date..."
                            additions="{ bottom: 'end_bottom-template-url' }">
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <div class="col-sm-4">
                        <label for="allow_multiple">Allow multiple vote</label>
                        <select id="allow_multiple" name="allow_multiple" class="form-control input-sm" ng-model="condition.allow_multiple">
                        <option value>All</option>
                        <option value="true">Allow</option>
                        <option value="false">Deny</option>
                      </select>
                      </div>
                      <div class="col-sm-4">
                        <label for="allow_add">Allow member suggest</label>
                        <select id="allow_add" name="allow_add" class="form-control input-sm" ng-model="condition.allow_add">
                          <option value>All</option>
                          <option value="true">Allow</option>
                          <option value="false">Deny</option>
                        </select>
                      </div>
                      <div class="col-sm-4">
                        <label for="allow_guest">Allow guest vote</label>
                        <select id="allow_guest" name="allow_guest" class="form-control input-sm" ng-model="condition.allow_guest">
                          <option value>All</option>
                          <option value="true">Allow</option>
                          <option value="false">Deny</option>
                        </select>
                      </div>
                    </div>

                    <div class="form-group">
                      <div class="col-sm-6">
                        <div class="col-sm-12 pdn"><label>Comments count</label></div>
                        <div class="col-sm-6 pdn">
                          <select class="form-control input-sm" ng-model="condition.cmts_pref">
                            <option value>Not set</option>
                            <option value="least">As least</option>
                            <option value="most">As most</option>
                          </select>
                        </div>
                        <div class="col-sm-6 pdn">
                          <input name="cmts" id="cmts" type="text" class="form-control input-sm" placeholder="Comments count" ng-model="condition.cmts">
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="col-sm-12 pdn"><label>Likes</label></div>
                        <div class="col-sm-6 pdn">
                          <select class="form-control input-sm" ng-model="condition.likes_pref">
                            <option value>Not set</option>
                            <option value="least">As least</option>
                            <option value="most">As most</option>
                          </select>
                        </div>
                        <div class="col-sm-6 pdn">
                          <input name="likes" id="likes" type="text" class="form-control input-sm" placeholder="Likes count" ng-model="condition.likes">
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="col-sm-6">
                        <div class="col-sm-12 pdn"><label>Votes</label></div>
                        <div class="col-sm-6 pdn">
                          <select class="form-control input-sm" ng-model="condition.votes_pref">
                            <option value>Not set</option>
                            <option value="least">As least</option>
                            <option value="most">As most</option>
                          </select>
                        </div>
                        <div class="col-sm-6 pdn">
                          <input name="votes" id="votes" type="text" class="form-control input-sm" placeholder="Votes count" ng-model="condition.votes">
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="col-sm-12 pdn"><label>Views</label></div>
                        <div class="col-sm-6 pdn">
                          <select class="form-control input-sm" ng-model="condition.views_pref">
                            <option value>Not set</option>
                            <option value="least">As least</option>
                            <option value="most">As most</option>
                          </select>
                        </div>
                        <div class="col-sm-6 pdn">
                          <input name="views" id="views" type="text" class="form-control input-sm" placeholder="Views count" ng-model="condition.views">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="clearfix"></div>
              </div>
            </div>
          </form>
        </div>
        <hr class="mgn">
        <div class="card-footer">
          <button class="btn btn-warning btn-sm pull-left" ng-click="clear_filter()">Clear</button>
          <div class="clearfix"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- Indicator -->
  <div class="row" ng-show="busy">
    <div class="loader"></div>
  </div>

  <!-- Message -->
  <div class="row pd6l pd6r" ng-show="polls.length > 0">
    <div class="notice notice-success">{{polls.length}} result(s) matching.</div>
  </div>
  <!-- Result -->
  <div class="row" ng-show="polls.length > 0">
    <div class="col-xs-12 pdn">
      <div ng-repeat="poll in polls | orderBy: sort" class="card">
        <div class="card-body">
          <div clas="poll-header">
            <div class="user-avatar pull-left">
              <a ng-if="poll.user" ui-sref="profile.info({userId: poll.user._id})">
              <img src="{{poll.user.profileImageURL}}" alt="{{poll.user.displayName}}">
            </a>
              <img ng-if="!poll.user" src="modules/users/client/img/profile/default.png" alt="Deleted User">
            </div>
            <span class="pull-left">
            <strong><a class="undecorated-link" ui-sref="profile.info({userId: poll.user._id})" ng-if="poll.user" ng-bind="poll.user.displayName"></a></strong>
            <span ng-if="!poll.user">Deleted User</span>
            <small class="text-muted">&nbsp;created on</small>
            <small class="text-muted" am-time-ago="poll.created"></small>
            </span>
            <span class="pull-right">
            <md-menu md-offset="-12 20" md-position-mode="target-right target">
              <a class="undecorated-link span-link" ng-click="$mdMenu.open($event)" aria-label="Open setting menu">
                <i class="fa fa-angle-down"></i>
              </a>
              <md-menu-content>
                <ul class="menu-list">
                  <li><a ui-sref="polls.view({ pollId: poll._id })"><i class="fa fa-eye"></i>&nbsp;View</a></li>
                  <li ng-if="user._id === poll.user._id"><a class="undecorated-link" ui-sref="polls.edit({ pollId: poll._id })"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</a></li>
                  <li ng-if="user._id === poll.user._id"><a class="undecorated-link" ng-click="delete_poll(poll)"><i class="fa fa-trash"></i>&nbsp;Delete</a></li>
                  <li ng-if="isLogged">
                    <a ng-click="follow_poll(poll)" class="undecorated-link">
                      <i class="fa fa-rss"></i>&nbsp;{{(poll.follow._id) ? 'Unfollow' : 'Follow'}}
                    </a>
                  </li>
                  <li ng-if="isLogged && user._id !== poll._id && !poll.reported"><a class="undecorated-link" ng-click="report_poll(poll)"><i class="fa fa-exclamation-circle"></i>&nbsp;Report poll</a></li>
                  <li ng-if="isLogged && user._id !== poll._id && !poll.bookmarked"><a class="undecorated-link" ng-click="bookmark_poll(poll)"><i class="fa fa-bookmark"></i>&nbsp;Bookmark poll</a></li>
                </ul>
              </md-menu-content>
            </md-menu>
          </span>
            <br>
            <div class="mg5t">
              <span ng-if="poll.allow_guest" class="fa fa-globe">
              <md-tooltip md-direction="bottom">This poll is public</md-tooltip>
            </span>
              <span ng-if="!poll.allow_guest" class="fa fa-users">
              <md-tooltip md-direction="bottom">Only user can vote</md-tooltip>
            </span>
              <a class="undecorated-link" ui-sref="categorys.polls({ categoryId: poll.category._id })">{{ poll.category.name }}</a>
            </div>
            <div class="clearfix"></div>
            <hr class="mg5t mg10b">
          </div>

          <div clas="poll-body">
            <h3><a class="undecorated-link" ui-sref="polls.view({ pollId: poll._id })">{{poll.title}}</a></h3>
            <!--<p class="text-justify poll_item_body" ng-bind-html="poll.summary | nl2br"></p>-->
            <div class="text-body" ta-bind="text" ng-model="poll.summary" ta-readonly="true"></div>
            <div class="clearfix"></div>
            <!-- #options -->
          </div>
          <div class="clearfix"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- Message -->
  <div class="row pd6l pd6r">
    <div class="notice notice-warning" ng-show="polls.length === 0 && !busy">No matches found.</div>
  </div>
</section>
<script type="text/ng-template" id="start_bottom-template-url">
  <button class="btn btn-info btn-sm btn-block" ng-click="clear_created_start()">
    Clear
  </button>
</script>
<script type="text/ng-template" id="end_bottom-template-url">
  <button class="btn btn-info btn-sm btn-block" ng-click="clear_created_end()">
    Clear
  </button>
</script>
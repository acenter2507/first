<section class="container" infinite-scroll="vm.loadCmts()" infinite-scroll-distance='1'>
  <div class="row mg20t mg20b">
    <div class="col-xs-12">
      <button type="button" class="btn btn-primary pull-right">Create poll</button>
    </div>
  </div>
  <div class="row">
    <!-- Title and category -->
    <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
      <div class="card" id="poll_title_card">
        <p>
          <i ng-class="['fa', vm.poll.category.icon]"></i>&nbsp;
          <a class="undecorated-link" ui-sref="categorys.view({ categoryId: vm.poll.category._id })">
            {{vm.poll.category.name}}
          </a>
          <a class="undecorated-link pull-right" ng-click="vm.toggle_follow_poll()">
            <i class="fa fa-rss"></i>&nbsp;{{(vm.polluser.following) ? 'Unfollow' : 'Follow'}}
            <md-tooltip md-direction="bottom">{{(vm.polluser.following) ? 'Following this poll' : 'You not follow this poll yet'}}</md-tooltip>
          </a>
        </p>
        <a class="undecorated-link" ui-sref="polls.view({ pollId: vm.poll._id })">
          <h3 class="mg5t mg5b" ng-bind="vm.poll.title"></h3>
        </a>
      </div>
      <!-- First post -->
      <div class="card" id="poll_first_post_card">
        <div clas="post-header">
          <div class="user-avatar pull-left">
            <a ui-sref="users.info({userId: vm.poll.user._id})" ng-if="vm.poll.user">
              <img src="{{vm.poll.user.profileImageURL}}" alt="{{vm.poll.user.displayName}}">
            </a>
            <img ng-if="!vm.poll.user" src="modules/users/client/img/profile/default.png" alt="Deleted User">
          </div>
          <span class="pull-left">
            <strong><a class="undecorated-link" ui-sref="users.info({userId: vm.poll.user._id})" ng-if="vm.poll.user" ng-bind="vm.poll.user.displayName"></a></strong>
            <span ng-if="!vm.poll.user">Deleted User</span>
            <span class="text-muted"><small>&nbsp;created on</small></span>
            <span class="text-muted" ng-bind="vm.poll.created | date:'mediumDate'"></span>
          </span>
          <span class="pull-right">
            <a href="#" bs-dropdown aria-haspopup="true" aria-expanded="false">
              <i class="fa fa-chevron-down" aria-hidden="true"></i>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li ng-show="vm.isLogged">
                <a ng-click="vm.follow_poll()" class="undecorated-link">
                  <i class="fa fa-rss"></i>&nbsp;{{(vm.polluser._id && vm.polluser.following) ? 'Unfollow' : 'Follow'}}
                </a>
              </li>
              <li ng-show="vm.isLogged && !vm.poll.isCurrentUserOwner"><a class="undecorated-link" ng-click="vm.report_poll()"><i class="fa fa-exclamation-circle"></i>&nbsp;Report poll</a></li>
              <li ng-show="vm.poll.isCurrentUserOwner || vm.poll.canEdit"><a class="undecorated-link" ui-sref="polls.edit({ pollId: vm.poll._id })"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</a></li>
              <li ng-show="vm.poll.isCurrentUserOwner || vm.poll.canEdit"><a class="undecorated-link" ng-click="vm.remove()"><i class="fa fa-trash"></i>&nbsp;Delete</a></li>
              <li ng-show="vm.isLogged && !vm.poll.isCurrentUserOwner"><a class="undecorated-link" ng-click="vm.add_bookmark(poll)"><i class="fa fa-bookmark"></i>&nbsp;Bookmark poll</a></li>
            </ul>
          </span>
          <br>
          <span ng-if="vm.poll.allow_guest" class="fa fa-globe">
            <md-tooltip md-direction="bottom">This poll is public</md-tooltip>
          </span>
          <span ng-if="!vm.poll.allow_guest" class="fa fa-users">
            <md-tooltip md-direction="bottom">Only user can vote</md-tooltip>
          </span>
          <hr class="mg10t mg10b">
          <div class="clearfix"></div>
        </div>
        <div class="post-body">
          <p class="text-justify" ng-bind="vm.poll.body"></p>
          <hr class="mg10t mg10b">
        </div>
        <div class="post-footer">
          <small class="like_tools">
            <a class="undecorated-link" ng-click="vm.like_poll()" ng-show="vm.like.type == 1"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i>&nbsp;Like</a>
            <span class="span_btn" ng-click="vm.like_poll()" ng-show="vm.like.type != 1"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i>&nbsp;Like</span>
            <span class="mg5l mg5r" ng-bind="vm.poll.likeCnt"></span>
            <a class="undecorated-link" ng-click="vm.dislike_poll()" ng-show="vm.like.type == 2"><i class="fa fa-thumbs-o-down" aria-hidden="true"></i>&nbsp;Dislike</a>
            <span class="span_btn" ng-click="vm.dislike_poll()" ng-show="vm.like.type != 2"><i class="fa fa-thumbs-o-down" aria-hidden="true">&nbsp;Dislike</i></span>
          </small>
          <small class="pull-right mg10l" ng-show="vm.stopped">
            Sort:&nbsp;
            <a class="undecorated-link" bs-dropdown aria-haspopup="true" aria-expanded="false">
              {{vm.cmt_sort.name}}&nbsp;<i class="fa fa-angle-down"></i>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li ng-repeat="cmt_sort in vm.cmt_sorts" ng-click="vm.cmt_sort = vm.cmt_sorts[$index]">
                <a class="undecorated-link" ng-click="vm.cmt_sort = vm.cmt_sorts[$index]">{{cmt_sort.name}}</a>
              </li>
            </ul>
          </small>
          <small class="pull-right">
            <a ng-if="!vm.poll.isCurrentUserOwner" ng-click="vm.reply_cmt(vm.poll)" class="undecorated-link">Reply</a>
            <a ng-click="vm.focus_cmt()" class="undecorated-link mg10l">Comment</a>
          </small>
          <div class="clearfix"></div>
        </div>
      </div>
      <!-- Options -->
      <div class="card" id="opts_detail_card">
        <span class="text-muted" ng-if="!vm.opts.length || vm.opts.length === 0">Has no option added.</span>
        <div class="panel-group mgnb" role="tablist" aria-multiselectable="true" bs-collapse ng-if="vm.opts.length > 0">
          <div class="panel panel-default custom-panel" ng-repeat="opt in vm.opts">
            <div class="panel-heading" role="tab">
              <h4 class="panel-title">
                <a class="undecorated-link" bs-collapse-toggle>Option&nbsp;{{$index + 1}}:&nbsp;{{ opt.title }}
                  <md-tooltip md-direction="bottom">Click to view detail</md-tooltip>
                </a>
              </h4>
            </div>
            <div class="panel-collapse" role="tabpanel" bs-collapse-target>
              <div class="panel-body">
                <small class="pull-right text-muted">
                  <span>Added by&nbsp;</span>
                  <a class="undecorated-link" ui-sref="users.info({userId: opt.user._id})" ng-if="opt.user" ng-bind="opt.user.displayName"></a>
                  <a ui-sref="users.info({userId: vm.poll.user._id})" ng-if="opt.user"></a>
                  <span ng-if="!opt.user">Deleted User</span>
                  <span>&nbsp;on</span>
                  <span ng-bind="opt.created | date:'mediumDate'"></span>
                </small><br>
                <div class="clearfix"></div>
                <img ng-if="opt.image" src="{{opt.image}}" alt="{{opt.title}}">
                <p class="text-justify" ng-bind="opt.body"></p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Comment form -->
      <div class="card" id="poll_cmt_form_card" ng-if="vm.isLogged">
        <div class="form-group">
          <span ng-if="vm.tmp_cmt.to">To:&nbsp;</span>
          <a class="undecorated-link" ng-if="vm.tmp_cmt.to" ui-sref="users.info({userId: vm.tmp_cmt.to})" ng-bind="vm.tmp_cmt.toName"></a>
        </div>
        <div class="form-group">
          <div class="user-avatar pull-left" ng-if="vm.authentication.user">
            <a ui-sref="users.info({userId: cmt.user._id})">
            <img src="{{vm.authentication.user.profileImageURL}}" alt="{{vm.authentication.user.displayName}}">
          </a>
          </div>
          <textarea ng-is-enter="{{vm.enter_send}}" ng-enter="vm.save_cmt()" focus-me="{{vm.cmt_typing}}" class="msd-elastic: \n; reply-input"
            data-ng-model="vm.tmp_cmt.body" placeholder="Type your comment..."></textarea>
        </div>
        <label class="text-muted"><input type="checkbox" ng-model="vm.enter_send"><small>&nbsp;Enter to send</small></label>
        <span class="pull-right">
          <a class="undecorated-link" ng-hide="vm.enter_send" ng-click="vm.save_cmt()">Send</a>
          <a class="mg20l undecorated-link" ng-click="vm.discard_cmt()" ng-if="vm.tmp_cmt.discard">Discard</a>
        </span>
      </div>
      <!-- List comments -->
      <div ui-view="cmts"></div>
      <!-- Load indicator -->
      <div class="card" id="indicator_card" ng-show="vm.busy">
        <md-progress-circular ng-disabled="!vm.busy" class="md-hue-2 center" md-diameter="20px"></md-progress-circular>
      </div>
    </div>
    <!-- Poll report -->
    <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 pdnl">
      <!-- Report -->
      <div class="card" id="poll_report_card">
        <div class="col-xs-4 pdn">
          <div class="poll_info_item pull-left">
            <span class="text-center"><strong>VIEWS</strong></span>
            <span class="text-center" ng-bind="vm.poll.viewCnt"></span>
            <br>
          </div>
        </div>
        <div class="col-xs-4 pdn text-center">
          <div class="poll_info_item">
            <span class="text-center"><strong>VOTES</strong></span>
            <span class="text-center" ng-bind="vm.poll.voteCnt"></span>
            <br>
          </div>
        </div>
        <div class="col-xs-4 pdn">
          <div class="poll_info_item pull-right">
            <span class="text-center"><strong>COMMENTS</strong></span>
            <span class="text-center" ng-bind="vm.poll.cmtCnt"></span>
            <br>
          </div>
        </div>
        <div class="clearfix"></div>
      </div>
      <!-- Vote card -->
      <div class="card">
        <span class="text-muted" ng-if="!vm.opts.length || vm.opts.length === 0"><small>No option to vote.</small></span>
        <div class="form-group" ng-repeat="opt in vm.opts" ng-if="!vm.poll.allow_multiple">
          <label class="control control--radio">
            {{opt.title}}<span class="mg5l" ng-style="{color: opt.color}"><strong>●</strong></span>
            <input type="radio" name="vote_radio" ng-checked="vm.is_voted(opt._id)" ng-click="vm.checked(opt._id)"/>
            <div class="control__indicator"></div>
          </label>
        </div>
        <div class="form-group" ng-repeat="opt in vm.opts" ng-if="vm.poll.allow_multiple">
          <label class="control control--checkbox">
            {{opt.title}}<span class="mg5l" ng-style="{color: opt.color}"><strong>●</strong></span>
            <input type="checkbox" ng-checked="vm.is_voted(opt._id)" ng-click="vm.checked(opt._id)"/>
            <div class="control__indicator"></div>
          </label>
        </div>
        <div class="form-group">
          <button ng-if="vm.opts.length > 0" class="btn btn-info pull-right" ng-click="vm.save_vote()">{{(vm.ownVote._id) ? 'Change vote' : 'Vote'}}</button>
          <button ng-if="vm.isLogged && vm.poll.allow_add && !vm.poll.isCurrentUserOwner" class="btn btn-warning pull-right mg10r" ng-click="vm.input_opt()">Suggest options</button>
        </div>
        <div class="clearfix"></div>
      </div>
      <!-- Chart -->
      <div ui-view="opts"></div>
      <!-- Tag -->
      <div class="card" id="poll_tags_card">
        <strong><span>Tags: </span></strong><small>{{(!vm.poll.tags.length || vm.poll.tags.length === 0) ? 'Has no tag added' : ''}}</small>
        <ul class="tags" ng-show="vm.poll.tags.length">
          <li ng-repeat="tag in vm.poll.tags"><a ui-sref="tags.view({ tagId: tag._id })" class="tag">{{tag.name}}</a></li>
        </ul>
      </div>
      <!-- Ad -->
      <div class="card h1000"></div>
    </div>
    <div class="clearfix"></div>
  </div>
</section>